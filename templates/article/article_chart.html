{% extends "base.html" %}

{% block content %}

    <form method="get" action="">
        <label for="start_date">Desde:</label>
        <input type="date" id="start_date" name="start_date" value="{{ request.GET.start_date }}">

        <label for="end_date">Hasta:</label>
        <input type="date" id="end_date" name="end_date" value="{{ request.GET.end_date }}">

        <label for="author">Autor:</label>
        <select id="author" name="author">
            <option value="">Todos</option>
            {% for author in authors %}
                <option value="{{ author.id }}" {% if author.id|stringformat:"s" == request.GET.author %}selected{% endif %}>
                    {{ author.username }}
                </option>
            {% endfor %}
        </select>

        <label for="category">Categor√≠a:</label>
        <select id="category" name="category">
            <option value="">Todas</option>
            {% for category in categories %}
                <option value="{{ category.id }}" {% if category.id|stringformat:"s" == request.GET.category %}selected{% endif %}>
                    {{ category.name }}
            </option>
            {% endfor %}
        </select>

        <button type="submit">Aplicar filtros</button>
    </form>

    <style>
  form {
    display: flex;
    gap: 1rem; /* Adjust spacing between filters as needed */
    align-items: center;
    margin-bottom: 1rem;
  }
    </style>

  <h2>Cantidad de likes por articulo</h2>
  <canvas id="likesChart"></canvas>

  <h2>Cantidad de dislikes por articulo</h2>
  <canvas id="dislikesChart"></canvas>

  <h2>Article Average Rating Comparison</h2>
  <canvas id="avgRatingChart"></canvas>

  <h2>Article Average Views Comparison</h2>
  <canvas id="avgViewsChart"></canvas>

  <h2>Article Shares Comparison</h2>
  <canvas id="sharesChart"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Data for likes chart
    const likesData = {{ likes_data|safe }};
    const likesCtx = document.getElementById('likesChart').getContext('2d');
    new Chart(likesCtx, {
      type: 'bar',
      data: {
        labels: likesData.titles,
        datasets: [
          {
            label: 'Likes',
            data: likesData.likes,
            backgroundColor: 'rgba(54, 162, 235, 0.7)' // Blue color
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            title: {
              display: true,
              text: 'Articulos'
            }
          },
          y: {
            title: {
              display: true,
              text: 'Numero de likes'
            }
          }
        }
      }
    });

    // Data for dislikes chart
    const dislikesData = {{ dislikes_data|safe }};
    const dislikesCtx = document.getElementById('dislikesChart').getContext('2d');
    new Chart(dislikesCtx, {
      type: 'bar',
      data: {
        labels: dislikesData.titles,
        datasets: [
          {
            label: 'Dislikes',
            data: dislikesData.dislikes,
            backgroundColor: 'rgba(54, 162, 235, 0.7)' // Blue color
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            title: {
              display: true,
              text: 'Articulos'
            }
          },
          y: {
            title: {
              display: true,
              text: 'Numero de dislikes'
            }
          }
        }
      }
    });

    // Data for average rating chart
    const avgRatingData = {{ avg_rating_data|safe }};
    const avgRatingCtx = document.getElementById('avgRatingChart').getContext('2d');
    new Chart(avgRatingCtx, {
      type: 'bar',
      data: {
        labels: avgRatingData.titles,
        datasets: [
          {
            label: 'Puntaje promedio',
            data: avgRatingData.ratings,
            backgroundColor: 'rgba(54, 162, 235, 0.7)' // Blue color
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            title: {
              display: true,
              text: 'Articulos'
            }
          },
          y: {
            title: {
              display: true,
              text: 'Puntaje promedio'
            }
          }
        }
      }
    });

    // Data for average views chart
    const avgViewsData = {{ avg_views_data|safe }};
    const avgViewsCtx = document.getElementById('avgViewsChart').getContext('2d');
    new Chart(avgViewsCtx, {
      type: 'bar',
      data: {
        labels: avgViewsData.titles,
        datasets: [
          {
            label: 'Visualizaciones',
            data: avgViewsData.views,
            backgroundColor: 'rgba(54, 162, 235, 0.7)' // Blue color
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            title: {
              display: true,
              text: 'Articulos'
            }
          },
          y: {
            title: {
              display: true,
              text: 'Numero de visualizaciones'
            }
          }
        }
      }
    });

    // Data for shares chart
    const sharesData = {{ shares_data|safe }};
    const sharesCtx = document.getElementById('sharesChart').getContext('2d');
    new Chart(sharesCtx, {
      type: 'bar',
      data: {
        labels: sharesData.titles,
        datasets: [
          {
            label: 'Compartidos',
            data: sharesData.shares,
            backgroundColor: 'rgba(54, 162, 235, 0.7)' // Blue color
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            title: {
              display: true,
              text: 'Articulos'
            }
          },
          y: {
            title: {
              display: true,
              text: 'Numero de veces que fue compartido'
            }
          }
        }
      }
    });
  </script>
{% endblock %}
