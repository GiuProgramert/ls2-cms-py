{% extends "base.html" %}  

{% block headblock %}
{% load static %}
  <link rel="stylesheet" href="{% static 'css/article_detail.css' %}">
  <link href="{% static 'mdeditor/css/editormd.min.css' %}" rel="stylesheet">
  <link href="{% static 'mdeditor/css/editormd.preview.css' %}" rel="stylesheet">
{% endblock headblock %}

{% block content %}

<div class="article-details-container">

    <div class="article-header">
      <h1 class="article-title">{{ article.title }}</h1>

      <div class="article-actions">

        {% if article.state == 'r' and can_edit_as_editor %}
          <a href="{% url 'article-update' article.id %}" class="detail-link">Editar como editor</a>
        {% elif article.state == 'd' and can_edit_as_author %}
          <a href="{% url 'article-update' article.id %}" class="detail-link">Editar como autor</a>
        {% endif %}

        {% if can_edit and article.state != 'r' %}
          <a href="{% url 'article-to-draft' pk=article.id %}" class="detail-link">Pasar a Borrador</a>
        {% endif %}

        {% if can_edit and article.state == 'd' %}
          <a href="{% url 'article-to-revision' pk=article.id %}" class="detail-link">Pasar a Revisión</a>
        {% endif %}

        {% if can_publish and article.state == 'r' %}
            <a href="{% url 'article-to-published' pk=article.id %}" class="detail-link">Publicar</a>
        {% endif %}
        
        {% if not is_moderated_category and article.state == 'r' %}
            <a href="{% url 'article-to-published' pk=article.id %}" class="detail-link">Publicar</a>
        {% endif %}

        {% if can_edit and article.state != 'i' %}
          <a href="{% url 'article-to-inactive' pk=article.id %}" class="detail-link">Inactivar</a>
        {% endif %}
        
      </div>

      <div>
        <h2 class="article-title">Descripción</h2>
        <p class="article-description">{{ article.description }}</p>
      </div>

      <div>
        <h2 class="article-title">Categoría</h2>
        <p class="article-description">{{ article.category.name }}</p>
      </div>

      <div>
        <h2 class="article-title">Estado</h2>
        <p class="article-description">
          {% if article.state == 'd' %}
            Borrador
          {% elif article.state == 'p' %}
            Publicado
          {% elif article.state == 'i' %}
            Inactivo
          {% elif article.state == 'r' %}
            Revisión
          {% endif %}
        </p>
      </div>
    </div>

    <div class="article-body">{{ article_render_content|safe }}</div>

    <div class="article-history">
      {% if can_edit %}
        <a href="{% url 'article-update-history' article.id %}" class="detail-link">Ver historial de cambios</a>
      {% endif %}
      <a href="{% if request.GET.from == 'home' %}{% url 'home' %}{% else %}{% url 'article-list' %}{% endif %}" class="detail-link">
        {% if request.GET.from == 'home' %}
          Volver a la página principal
        {% else %}
          Volver a la lista
        {% endif %}
      </a>
    </div>
</div>

{% endblock content %}